# MOHA-Final

## This is source code repository for MOHA
MOHA (Many-task computing On HAdoop) is a new framework to effectively combine Many-Task Computing technologies with the existing Big Data platform Hadoop. MOHA is developed as one of Hadoop YARN applications by utilizing YARN APIs so that it can transparently cohost existing MTC applications with other Big Data processing frameworks such as MapReduce in a single Hadoop cluster.

Users can utilize the MOHA Client (a plain Java object) to submit and monitor their MTC applications. Then MOHA runtime system automatically performs resource allocations through communicating with YARN ResourceManager and efficiently processes many tasks by employing multi-level scheduling mechanism.

### The project can be combined by using gradle, users can follow official instruction from:

https://gradle.org/guides/

### In order to submit MOHA applications to Hadoop system, we need to perform the following steps:

#### 1.	Environment preparation
##### a.	Configuration file
Configuration file resides in conf/*.conf. We need to specify following information

Zookeeper servers: 	 MOHA utilizes zookeeper servers (build in Hadoop system) to create communication between components in the system.      
```
Example:
MOHA.zookeeper.bootstrap.servers: 150.183.250.139:9092
MOHA.zookeeper.connect=localhost:2181
```
Job queue server:
The job queue used in MOHA is implemented based on a queue system. In the case of using ActiveMQ, type and server are specified.

```
Example: 
MOHA.queue.type=activemq
MOHA.queue.activemq.server=hdp01.kisti.re.kr:61616
```
##### b.	Application
User applications can be described in the form of a JDL file (job description language) with jdl extension. We currently support two kind of applications, “sweep-parameter “and “multiple execution” applications

###### Sweep-parameter applications:
Sweep-parameter are typically found in real-world applications. Tasks are generated by combining multiple input parameters; each of the parameters can be combined with each of others to create a particular task. The format is as followed:
```
Type: Type of application, S denotes sweep-parameter
Num of Input:
Key Value (Input 1) Key is the type of input, D denotes directory (Value will be the directory path), P denotes file (Value will be the file name). 
Key Value (Input 2)
…

Key Value (Input n)
Executable shell script: A file with extension *.sh
Dependency: A compressed file which consists of “everything”, such as binary, library and static input file.
```
This example is for autodock vina application (given in Autodock_Vina.sh)
```
S //sweep parameter
3 //number of input files is 3
D Drug/ligand //Folder that contains the first input file of a task
D Drug/pockets_sample_10000 // Folder that contains the second input file of a task
P scPDB_coordinates.tsv //Thirst input file
autodock_vina.sh //shell script
run.tgz //the compressed file that contains binary and other files
```
###### Multiple execution applications:
This kind of applications is mainly used for evaluation purposes. Its jdl format is described as follow:
```
Type  M denotes “multiple execution” applications
Num of executions
Executable shell script: A file with extension *.sh
Dependency: A compressed file which consists of “everything”, such as binary, library and static input file.
```
This example of performing a single docking task 1000000 times
```
M //multiple execution applications
1000000  //number of executions
autodock_vina.sh //shell script
run.tgz // the compressed file that contains binary and other files
```
For performing “sleep 0” task 100000 times
```
M //multiple execution applications
1000000  //number of executions
sleep.sh //shell script
run.tgz // the compressed file that contains sleep.sh file
```
In which, Sleep.sh contains a single line “sleep 0”

#### 2. Start ActiveMQ servers:
ActiveMQ binary can be downloaded from
http://activemq.apache.org/download-archives.html. 
Users can follow the instruction to start ActiveMQ server as this example:
```
./activemq-5.11/bin/activemq start

```
#### 3. Submit application
The given “moha-start.sh” is an example command to start submitting the application to Hadoop is given in “moha-start.sh”. Users can customize as follow:
```
yarn jar MOHA.jar org.kisti.moha.MOHA_Client: This is fixed for every application
-manager_memory: required memory for MOHA Manager
-executor_memory: required memory for MOHA Manager
-num_executors: number of MOHA TaskExectuor instances, each of which will be scheduled to run in a particular machine
-jar: MOHA Java Executable
-JDL: jdl file location
-conf: configuration file location
```
to perform moha-start.sh
```
./moha-start.sh

```
